---
title: "Data Prep: ALL Data"
---

```{r}
library(tidyverse)
library(readxl)
# Function to read excel file and remove the autogenerated index column.
read_excel_noindex <- function(filename) {
  x <- read_excel(filename)
  x %>%
    select(-`...1`) -> x
  x
}

cars <- read_excel_noindex("Cars/ALLcars.xlsx"); cars
pollution <- read_excel_noindex("Pollution/pollutants.xlsx"); pollution
health <- read_excel_noindex("Health/health.xlsx"); health

# Load data describing the type of car data collected for each country.
extraCountryData <- read_excel("extraCountryData.xlsx")
```



```{r}
cars %>% 
  left_join(health,by=c("id"="id")) %>% 
  left_join(pollution,by=c("id"="id")) %>% 
  separate(id,into=c("Country","Year"),sep="_") %>% 
  left_join(extraCountryData, by=c("Country"="Country")) %>% 
  mutate(`LPG+NaturalGas`=`LPG/NaturalGas`) %>% 
  select(Country, `WHO Region`, `Region`, Year:Electric, `LPG+NaturalGas`, Other, `VehicleType`, `Regis/Sales`, Sex, `Ischaemic heart disease_DALYs  (per 100 000 population)`:Value) -> ALLdata
ALLdata
```
Note that there are 6 pollutants. So, there should be 6 of each country-year combo. The pollutant data seems to go up to the year 2018 (even 2018 doesn't have all the pollutants).

```{r}
# Export to excel file so it can be easily processed after
library(xlsx)
write.xlsx(ALLdata, "ALLdata.xlsx")
```


